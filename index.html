<!DOCTYPE html>
<html lang="fr" id="html-root">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anime Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="favicon-32x32.png" type="image/png">
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen p-6">
  <h1 class="text-3xl font-bold text-center mb-4">🎥 Anime Tracker 🎥</h1>

  <!-- Dark mode toggle -->
  <div class="flex justify-center mb-6">
    <button id="darkToggle" class="bg-gray-800 text-white px-4 py-2 rounded-xl hover:bg-gray-700 transition">
      🌙 Mode sombre
    </button>
  </div>

  <!-- Liste des animés -->
  <div id="anime-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTlxH-2fyYlatWV1FVl0E5lmXNk_1K_23RhBSodkZ38RB8XX0MrR75wzxcXMx9TCLMcwmHupt4FWWku/pub?gid=15026583&single=true&output=csv";

    fetch(sheetUrl)
      .then(res => {
        if (!res.ok) throw new Error("Erreur de chargement");
        return res.text();
      })
      .then(data => {
        const rows = data.trim().split('\n').slice(1);
        const animeData = rows.map(row => {
          const [titre, slug, episodes_vus, episodes_dispo, image_url, nb_episode] = row.split(',');
          return {
            titre,
            slug,
            episodes_vus: parseInt(episodes_vus),
            episodes_dispo: parseInt(episodes_dispo),
            image_url,
            nb_episode
          };
        });

        animeData.sort((a, b) => {
          const aAVoir = a.episodes_dispo - a.episodes_vus;
          const bAVoir = b.episodes_dispo - b.episodes_vus;
          return bAVoir - aAVoir;
        });

        displayAnime(animeData);
      })
      .catch(err => {
        document.getElementById("anime-list").innerHTML = `<p class="text-red-500">Impossible de charger les données 😢</p>`;
        console.error(err);
      });

    function displayAnime(data) {
      const animeList = document.getElementById("anime-list");
      animeList.innerHTML = "";

      data.forEach(anime => {
        const aVoir = anime.episodes_dispo - anime.episodes_vus;
        const prochain = anime.episodes_vus + 1;
        const lien = `https://v6.voiranime.com/anime/${anime.slug}/${anime.slug}-${prochain.toString().padStart(2, '0')}-vostfr/`;

        const card = document.createElement("div");
        card.className = "bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 flex flex-col md:flex-row items-start space-x-4";

        card.innerHTML = `
          <div class="flex-shrink-0">
            <img src="${anime.image_url}" alt="${anime.titre}" onerror="this.src='fallback.jpg'" class="w-32 h-48 object-cover mb-4 md:mb-0">
          </div>
          <div class="flex flex-col justify-start">
            <h2 class="text-xl font-semibold mb-2">${anime.titre}</h2>
            <p class="mb-1">📼 Total d'épisodes 📼 : ${anime.nb_episode}</p>
            <p class="mb-1">🎬 Visionnés 🎬 : ${anime.episodes_vus}</p>
            <p class="mb-1">📺 Sortis 📺 : ${anime.episodes_dispo}</p>
            <p class="mb-2">🔥 À mater 🔥 : ${aVoir} épisode${aVoir > 1 ? 's' : ''}</p>
            <a href="${lien}" target="_blank" class="w-48 text-center bg-blue-600 dark:bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-700 dark:hover:bg-blue-600 transition ${aVoir === 0 ? 'cursor-not-allowed bg-gray-400 dark:bg-gray-600' : ''}" ${aVoir === 0 ? 'disabled' : ''}>
              ${aVoir === 0 ? 'À jour' : `Regarder épisode ${prochain}`}
            </a>
          </div>
        `;
        animeList.appendChild(card);
      });
    }

    // Dark mode toggle
    const html = document.getElementById("html-root");
    const darkToggle = document.getElementById("darkToggle");

    // Vérifier le thème dans localStorage et l'appliquer
    if (localStorage.getItem("theme") === "dark") {
      html.classList.add("dark");
      darkToggle.textContent = "☀️ Mode clair";  // Changer le texte du bouton en mode sombre
    } else {
      darkToggle.textContent = "🌙 Mode sombre";  // Changer le texte du bouton en mode clair
    }

    // Écouter le clic sur le bouton pour changer de thème
    darkToggle.addEventListener("click", () => {
      // Toggle la classe dark pour changer de thème
      html.classList.toggle("dark");

      // Si le mode sombre est activé, enregistrer le mode sombre dans localStorage
      const isDark = html.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");

      // Modifier le texte du bouton en fonction du mode
      darkToggle.textContent = isDark ? "☀️ Mode clair" : "🌙 Mode sombre";
    });
  </script>
</body>
</html>




