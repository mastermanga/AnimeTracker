<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ma Liste d'AnimÃ©s</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <h1 class="text-3xl font-bold text-center mb-6">ðŸŽ¥ AnimÃ©s Ã  Voir</h1>

  <div id="anime-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTlxH-2fyYlatWV1FVl0E5lmXNk_1K_23RhBSodkZ38RB8XX0MrR75wzxcXMx9TCLMcwmHupt4FWWku/pub?gid=15026583&single=true&output=csv";

    fetch(sheetUrl)
      .then(res => res.text())
      .then(data => {
        const rows = data.trim().split('\n').slice(1); // skip header
        const animeData = rows.map(row => {
          const [titre, slug, episodes_vus, episodes_dispo, image_url, nb_episode] = row.split(',');
          return {
            titre,
            slug,
            episodes_vus: parseInt(episodes_vus),
            episodes_dispo: parseInt(episodes_dispo),
            image_url,
            nb_episode
          };
        });

        displayAnime(animeData);
      });

    function displayAnime(data) {
      const animeList = document.getElementById("anime-list");
      animeList.innerHTML = "";

      data.forEach((anime, index) => {
        const aVoir = anime.nb_episode - anime.episodes_vus;
        const prochain = anime.episodes_vus + 1;
        const lien = `https://v6.voiranime.com/anime/${anime.slug}/${anime.slug}-${prochain.toString().padStart(2, '0')}-vostfr/`;

        const card = document.createElement("div");
        card.className = "bg-white rounded-2xl shadow-md p-4 flex flex-col md:flex-row items-start space-x-4";

        // Conteneur de l'image et du texte
        card.innerHTML = `
          <div class="flex-shrink-0">
            <img src="${anime.image_url}" alt="${anime.titre}" class="w-32 h-48 object-cover mb-4 md:mb-0">
          </div>
          <div class="flex flex-col justify-start">
            <h2 class="text-xl font-semibold mb-2">${anime.titre}</h2>
            <p>ðŸŽ¬ Ã‰pisodes vus : ${anime.episodes_vus}</p>
            <p>ðŸ“º Dispo : ${anime.nb_episode}</p>
            <p class="mb-2">ðŸ”¥ Ã€ voir : ${aVoir} Ã©pisode${aVoir > 1 ? 's' : ''}</p>
            <p class="mb-2">ðŸ“¼ Total d'Ã©pisodes : ${anime.nb_episode}</p>
            <a href="${lien}" target="_blank" class="bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700 transition">Regarder Ã©pisode ${prochain}</a>
            <button class="bg-green-600 text-white px-4 py-2 rounded-xl mt-4 hover:bg-green-700 transition" onclick="updateEpisodesVus(${index}, ${anime.episodes_vus})">Actualiser</button> <!-- Bouton d'actualisation -->
          </div>
        `;
        animeList.appendChild(card);
      });
    }

    // Fonction pour mettre Ã  jour le nombre d'Ã©pisodes vus dans Google Sheets
    function updateEpisodesVus(index, currentEpisodesVus) {
      const updatedEpisodesVus = currentEpisodesVus + 1;  // IncrÃ©menter de 1

      // Ici tu feras la requÃªte pour mettre Ã  jour le Google Sheets avec la nouvelle valeur d'Ã©pisodes vus
      console.log(`Mettre Ã  jour les Ã©pisodes vus de l'anime index ${index} : ${updatedEpisodesVus}`);

      // Appeler ici ton API backend ou fonction pour mettre Ã  jour le Google Sheets
      // Exemple : updateGoogleSheet(index, updatedEpisodesVus);

      // RÃ©actualiser l'affichage pour reflÃ©ter le changement
      location.reload(); // Pour rÃ©actualiser la page aprÃ¨s mise Ã  jour
    }

  </script>
</body>
</html>

